
# We allow http only for establishing the trust with ACME.
http://leaf.local {

	# This is http (for http-01 challenge from the ACME server.)
	@acmeChallenge path /.well-known/acme-challenge/*
	handle @acmeChallenge {
		root * /srv
		file_server
	}

	# https otherwise
	@notAcmeChallenge not path /.well-known/acme-challenge/*
	handle @notAcmeChallenge {
		redir https://leaf.local{uri} permanent
	}
}


https://leaf.local {


	tls {
		ca https://caddy-ca/acme/local/directory
		ca_root /etc/caddy/root.crt
	}

	respond "CA leaf running."
}
